ALTER TABLE PESSOA ADD NOME_COLLATE1 VARCHAR(60) CHARACTER SET WIN1252 COLLATE WIN_PTBR;
ALTER TABLE PESSOA ADD ORGAO_EMISSOR VARCHAR(20);
ALTER TABLE PESSOA ADD CERTIDAO_NASCIMENTO VARCHAR(35);
ALTER TABLE PESSOA ADD FALECIDO CHAR(1);
ALTER TABLE PESSOA ADD ID_EMPRESA INTEGER;

UPDATE PESSOA SET FALECIDO = 'N';

ALTER TABLE PESSOA
ADD CONSTRAINT FK_PESSOA_EMPRESA
FOREIGN KEY (ID_EMPRESA)
REFERENCES EMPRESA(ID)
ON UPDATE CASCADE;

CREATE OR ALTER TRIGGER PESSOA_NOME FOR PESSOA
ACTIVE BEFORE INSERT OR UPDATE POSITION 0
as
begin
  new.NOME_COLLATE = new.NOME;
end;


UPDATE PESSOA P SET P.nome = P.NOME;


ALTER TABLE EMPRESA_DIRETORIA ADD ENDERECO VARCHAR(60);
ALTER TABLE EMPRESA_DIRETORIA ADD COMPLEMENTO_END VARCHAR(60);
ALTER TABLE EMPRESA_DIRETORIA ADD NUM_END VARCHAR(15);
ALTER TABLE EMPRESA_DIRETORIA ADD BAIRRO VARCHAR(30);
ALTER TABLE EMPRESA_DIRETORIA ADD CEP VARCHAR(9);
ALTER TABLE EMPRESA_DIRETORIA ADD ID_CIDADE INTEGER;
ALTER TABLE EMPRESA_DIRETORIA ADD CIDADE VARCHAR(40);
ALTER TABLE EMPRESA_DIRETORIA ADD UF VARCHAR(2);


CREATE TABLE PESSOA_CID (
    CODIGO INTEGER NOT NULL,
    ID_CID INTEGER NOT NULL,
	PRINCIPAL CHAR(1),
    DATA_INICIO DATE,
    DATA_FINAL DATE);
	
ALTER TABLE PESSOA_CID
ADD CONSTRAINT PK_PESSOA_CID
PRIMARY KEY (CODIGO,ID_CID);


execute block
as
declare variable VID_CID integer;
declare variable VCODIGO integer;
begin
  for select CODIGO, ID_CID
      from PESSOA
      where coalesce(ID_CID, 0) > 0
      into :VCODIGO, :VID_CID
  do
  begin
    insert into PESSOA_CID (CODIGO, ID_CID,PRINCIPAL)
    values (:VCODIGO, :VID_CID, 'S');
  end
end; 


insert into deficiencia (id,nome) values (6, 'INTELECTUAL');